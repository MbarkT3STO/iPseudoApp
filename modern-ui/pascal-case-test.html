<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pascal Case Keywords Test - iPseudo IDE</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #569cd6;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #2d2d30;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #3e3e42;
        }
        .test-title {
            color: #4ec9b0;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .test-code {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            margin-bottom: 10px;
            overflow-x: auto;
        }
        .test-button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #1177bb;
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .output {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            color: #f48771;
        }
        .success {
            color: #4ec9b0;
        }
        .info {
            color: #569cd6;
        }
        .warning {
            color: #dcdcaa;
        }
        .keyword-highlight {
            color: #569cd6;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pascal Case Keywords Test - iPseudo IDE</h1>
        
        <div class="test-section">
            <div class="test-title">Test 1: Valid Pascal Case Algorithm Structure</div>
            <div class="test-code">Algorithm TestAlgorithm
Var x = 5
Var y = 10
Var sum = x + y
Print "Sum is", sum
Endalgorithm</div>
            <button class="test-button" onclick="testValidPascalAlgorithm()">Test Valid Pascal Algorithm</button>
            <div class="output" id="output1"></div>
        </div>

        <div class="test-section">
            <div class="test-title">Test 2: Mixed Case (Should Work)</div>
            <div class="test-code">Algorithm MixedCaseTest
var x = 5
Const y = 10
If x > 0 Then
    Print "Positive"
Else
    Print "Non-positive"
Endif
Endalgorithm</div>
            <button class="test-button" onclick="testMixedCase()">Test Mixed Case</button>
            <div class="output" id="output2"></div>
        </div>

        <div class="test-title">Test 3: Complex Pascal Case Algorithm</div>
        <div class="test-code">Algorithm FindMaximum
Var numbers = [3, 7, 2, 9, 1]
Var max = numbers[0]
Var i = 1

While i < 5
    If numbers[i] > max Then
        max = numbers[i]
    Endif
    i = i + 1
Endwhile

Print "Maximum number is", max
Endalgorithm</div>
        <button class="test-button" onclick="testComplexPascalAlgorithm()">Test Complex Pascal Algorithm</button>
        <div class="output" id="output3"></div>
    </div>

    <div class="test-section">
        <div class="test-title">Test 4: Function with Pascal Case</div>
        <div class="test-code">Algorithm FunctionTest
Function AddNumbers(a, b)
    Return a + b
Endfunction

Var result = AddNumbers(5, 3)
Print "Result is", result
Endalgorithm</div>
        <button class="test-button" onclick="testFunctionPascal()">Test Function Pascal</button>
        <div class="output" id="output4"></div>
    </div>

    <div class="test-section">
        <div class="test-title">Test 5: Loop with Pascal Case</div>
        <div class="test-code">Algorithm LoopTest
Var sum = 0
For i = 1 To 10
    sum = sum + i
Endfor
Print "Sum from 1 to 10 is", sum
Endalgorithm</div>
        <button class="test-button" onclick="testLoopPascal()">Test Loop Pascal</button>
        <div class="output" id="output5"></div>
    </div>

    <script>
        // Mock worker for testing validation
        function validatePseudo(src) {
            const lines = src.split(/\r?\n/);
            const issues = [];
            const blockStack = [];
            
            // Check for Algorithm/EndAlgorithm structure (both lowercase and Pascal Case)
            const hasAlgorithmStart = lines.some(line => {
                const trimmed = line.trim();
                return trimmed.toLowerCase().startsWith('algorithm ') || trimmed.startsWith('Algorithm ');
            });
            const hasAlgorithmEnd = lines.some(line => {
                const trimmed = line.trim();
                return trimmed.toLowerCase() === 'endalgorithm' || trimmed === 'Endalgorithm';
            });
            
            if (!hasAlgorithmStart) {
                issues.push({
                    line: 1,
                    text: lines[0] || '',
                    message: 'Missing Algorithm declaration. Pseudocode must start with "Algorithm <name>"'
                });
            }
            
            if (!hasAlgorithmEnd) {
                issues.push({
                    line: lines.length,
                    text: lines[lines.length - 1] || '',
                    message: 'Missing EndAlgorithm declaration. Pseudocode must end with "EndAlgorithm"'
                });
            }

            for (let i = 0; i < lines.length; i++) {
                const raw = lines[i];
                const lineNum = i + 1;
                const t = raw.trim();
                if (!t || t.startsWith('#')) continue;
                
                const lower = t.toLowerCase();
                
                // Check for Algorithm declaration (both cases)
                if (lower.startsWith('algorithm ') || t.startsWith('Algorithm ')) {
                    const m = t.match(/^(algorithm|Algorithm)\s+([a-zA-Z_$][\w$]*)\s*$/i);
                    if (!m) {
                        issues.push({ 
                            line: lineNum, 
                            text: raw, 
                            message: 'Malformed Algorithm declaration. Expected: Algorithm <name>' 
                        });
                    }
                    continue;
                }
                
                // Check for EndAlgorithm declaration (both cases)
                if (lower === 'endalgorithm' || t === 'Endalgorithm') {
                    if (blockStack.length > 0) {
                        issues.push({ 
                            line: lineNum, 
                            text: raw, 
                            message: 'EndAlgorithm found but there are unclosed blocks. Close all blocks before EndAlgorithm' 
                        });
                    }
                    continue;
                }
            }
            
            return issues;
        }

        function runTest(testCode, outputId) {
            const output = document.getElementById(outputId);
            output.innerHTML = '';
            
            const issues = validatePseudo(testCode);
            
            if (issues.length === 0) {
                output.innerHTML = '<span class="success">✅ Validation passed! No errors found.</span>';
                output.innerHTML += '\n\n<span class="info">Keywords detected:</span>\n';
                
                // Highlight Pascal Case keywords
                const pascalKeywords = ['Algorithm', 'Var', 'Const', 'If', 'Then', 'Else', 'Endif', 'For', 'To', 'Endfor', 'While', 'Endwhile', 'Print', 'Function', 'Endfunction', 'Return', 'Endalgorithm'];
                const foundKeywords = [];
                
                pascalKeywords.forEach(keyword => {
                    if (testCode.includes(keyword)) {
                        foundKeywords.push(`<span class="keyword-highlight">${keyword}</span>`);
                    }
                });
                
                if (foundKeywords.length > 0) {
                    output.innerHTML += foundKeywords.join(', ') + '\n';
                } else {
                    output.innerHTML += 'No Pascal Case keywords detected\n';
                }
            } else {
                output.innerHTML = '<span class="error">❌ Validation failed with the following errors:</span>\n\n';
                issues.forEach(issue => {
                    output.innerHTML += `<span class="error">Line ${issue.line}: ${issue.message}</span>\n`;
                    output.innerHTML += `<span class="info">  ${issue.text}</span>\n\n`;
                });
            }
        }

        function testValidPascalAlgorithm() {
            const code = `Algorithm TestAlgorithm
Var x = 5
Var y = 10
Var sum = x + y
Print "Sum is", sum
Endalgorithm`;
            runTest(code, 'output1');
        }

        function testMixedCase() {
            const code = `Algorithm MixedCaseTest
var x = 5
Const y = 10
If x > 0 Then
    Print "Positive"
Else
    Print "Non-positive"
Endif
Endalgorithm`;
            runTest(code, 'output2');
        }

        function testComplexPascalAlgorithm() {
            const code = `Algorithm FindMaximum
Var numbers = [3, 7, 2, 9, 1]
Var max = numbers[0]
Var i = 1

While i < 5
    If numbers[i] > max Then
        max = numbers[i]
    Endif
    i = i + 1
Endwhile

Print "Maximum number is", max
Endalgorithm`;
            runTest(code, 'output3');
        }

        function testFunctionPascal() {
            const code = `Algorithm FunctionTest
Function AddNumbers(a, b)
    Return a + b
Endfunction

Var result = AddNumbers(5, 3)
Print "Result is", result
Endalgorithm`;
            runTest(code, 'output4');
        }

        function testLoopPascal() {
            const code = `Algorithm LoopTest
Var sum = 0
For i = 1 To 10
    sum = sum + i
Endfor
Print "Sum from 1 to 10 is", sum
Endalgorithm`;
            runTest(code, 'output5');
        }
    </script>
</body>
</html>
